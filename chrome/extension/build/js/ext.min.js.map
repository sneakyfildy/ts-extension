{"version":3,"file":"ext.min.js","sources":["common/dates.js","background/record.js","background/clickHandler.js","background/msgRouter.js","background/localStorage.js","background/state.js","background/rt.js","background/listenContent.js","background/popupStartController.js","background/listenPopup.js","background/listenOptions.js","BackgroundMain.js"],"names":["define","Dates","prototype","weekdays","full","short","months","getFullDate","date","needSex","this","getHumanDate","getHumanTime","month","day","dateFormatted","Date","getTime","xx","getMonth","getDate","getFullYear","hours","mins","sex","getHours","getMinutes","getSeconds","value","parseInt","getDayName","opts","d","getDay","getMonthName","dates","RecordMaker","make","details","endTime","startTime","subject","sanitizeSubject","textArr","queue","id","setHours","setMinutes","unshift","join","copy","text","copyDiv","document","createElement","contentEditable","body","appendChild","innerHTML","unselectable","focus","execCommand","removeChild","before","after","replace","record","onItemClick","info","tab","chrome","tabs","sendMessage","method","onGetDetails","bind","contextMenus","create","title","contexts","onclick","MessageRouter","actionPrefix","runtime","onMessage","addListener","messageListener","add","a","b","map","request","sender","sendResponse","action","err","console","warn","callback","Storage","ls","window","localStorage","setItem","name","item","skipStringify","JSON","stringify","error","getItem","skipParse","parse","msgRouter","State","started","tickets","init","__init","onMsgGetState","restoreState","getState","toggleDayStart","setState","startTicket","contentPageData","validateTicketData","ticket","t","push","broadcastUpdateState","n","Notification","icon","setTimeout","close","data","getTicketById","filter","setOptions","state","moduleDefiniton","RT","cfg","url","debug","getTicket","fullUrl","getTicketPattern","ajax","success","onGetTicket","onGetTicketError","call","protoStuff","nonJqueryAjax","res","parsedRes","parseResponse","errorText","statusText","status","ticketResponse","r","statusLine","emptyLine","possibleErrorLine","line","split","shift","toLowerCase","indexOf","i","length","ticketData","ajaxParams","$","stuffName","amd","module","exports","RTConstructor","makeRecordRemote","makeRemoteAnswer","senderTabId","getTicketResponse","recordString","apply","PopupStartController","onClick","popupStartController","require"],"mappings":"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EAAA5B,YAAA,aAAAsD,KCFAoD,SACA,0BACA,2BACA,yBACA,4BACA,cAGA/L,OAAA,iBAAA;AXXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzGA,AD0GA;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrDA,ADsDA;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA,ADmDA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA,AD+IA;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClJA,ADmJA;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA,ADoBA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACTA,ADUA;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA,ADmBA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/* global chrome */\n\ndefine('common/dates',[\n], function(){\n    function Dates(){\n    }\n    Dates.prototype.weekdays = {\n        full: [\n            'Sunday',\n            'Monday',\n            'Tuesday',\n            'Wednesday',\n            'Thursday',\n            'Friday',\n            'Saturday'\n        ],\n        short: [\n            'Sun',\n            'Mon',\n            'Tue',\n            'Wed',\n            'Thu',\n            'Fri',\n            'Sat'\n        ]\n    };\n    Dates.prototype.months = {\n        full: [\n            'January',\n            'February',\n            'March',\n            'April',\n            'May',\n            'June',\n            'July',\n            'August',\n            'September',\n            'October',\n            'November',\n            'Decemeber'\n        ],\n        short: [\n            'Jan',\n            'Feb',\n            'Mar',\n            'Apr',\n            'May',\n            'Jun',\n            'Jul',\n            'Aug',\n            'Sep',\n            'Oct',\n            'Nov',\n            'Dec'\n        ]\n    };\n    Dates.prototype.getFullDate = function (date, needSex) {\n        return this.getHumanDate(date) + ' ' + this.getHumanTime(date, needSex);\n    };\n\n    Dates.prototype.getHumanDate = function (date) {\n        var month, day, dateFormatted;\n        date = new Date(date.getTime());\n        month = this.xx( date.getMonth() + 1 );\n        day = this.xx( date.getDate() );\n        dateFormatted = date.getFullYear() + '-' + month + '-' + day;\n\n        return dateFormatted;\n    };\n\n    Dates.prototype.getHumanTime = function (date, needSex) {\n        var hours, mins, sex, dateFormatted;\n        hours = this.xx( date.getHours() );\n        mins = this.xx( date.getMinutes() );\n        sex = this.xx( date.getSeconds() ); // \"secs\" =)\n        dateFormatted = hours + ':' + mins + (needSex ? (':' + sex) : '');\n\n        return dateFormatted;\n    };\n    /**\n     * Two digits, '1' -> '01'\n     * @param {Number} value\n     * @returns {String}\n     */\n    Dates.prototype.xx = function (value) {\n        value = parseInt(value, 10);\n        return value < 10 ? '0' + value : (value + '');\n    };\n\n    Dates.prototype.getDayName = function(date, opts){\n        opts = opts || {};\n        var d = date || new Date();\n        return this.weekdays[opts.short ? 'short' : 'full'][d.getDay()];\n    };\n    Dates.prototype.getMonthName = function(date, opts){\n        opts = opts || {};\n        var d = date || new Date();\n        return this.months[opts.short ? 'short' : 'full'][d.getMonth()];\n    };\n\n\n    return new Dates();\n\n});\n\n\n","define('background/record',[\n    'common/dates'\n], function(dates){\n    function RecordMaker(){\n    }\n\n    RecordMaker.prototype.make = function(details){\n        var dateFormatted, date, month, day, endTime, startTime, hours, mins;\n        details.subject = this.sanitizeSubject(details.subject);\n        var textArr = [details.queue, details.id, details.subject];\n\n        textArr[1] = 'RT:' + textArr[1];\n        textArr[2] = '\"' + textArr[2] + '\"';\n        date = new Date();\n        dateFormatted = dates.getHumanDate(date);\n\n        endTime = dates.getHumanTime(date);\n\n        date.setHours(10);\n        date.setMinutes(0);\n\n        startTime = dates.getHumanTime(date);\n\n        textArr.unshift(endTime);\n        textArr.unshift(startTime);\n        textArr.unshift(dateFormatted);\n\n        textArr = textArr.join(',');\n\n        this.copy(textArr);\n        return textArr;\n    };\n\n    RecordMaker.prototype.copy = function(text){\n        var copyDiv = document.createElement('div');\n        copyDiv.contentEditable = true;\n        document.body.appendChild(copyDiv);\n        copyDiv.innerHTML = text;\n        copyDiv.unselectable = \"off\";\n        copyDiv.focus();\n        document.execCommand('SelectAll');\n        document.execCommand(\"Copy\", false, null);\n        document.body.removeChild(copyDiv);\n    };\n\n    RecordMaker.prototype.sanitizeSubject = function(before){\n        var after;\n\n        after = before.replace(/\"/gim, '\\'');\n        return after;\n    };\n\n    return new RecordMaker();\n});\n","/* global chrome */\n\ndefine('background/clickHandler',['background/record'], function (record) {\n    chrome.contextMenus.create(\n        {\n            title: 'Form TS rec and ctrl+C',\n            contexts: [\"page\", \"selection\"],\n            onclick: onItemClick\n        }\n    );\n\n    function onItemClick(info, tab) {\n        chrome.tabs.sendMessage(tab.id, {method: \"tsGetDetails\"}, onGetDetails.bind(this, info));\n    }\n\n    function onGetDetails(info, details) {\n        details = details || {};\n        record.make(details);\n    }\n});\n","/* global chrome */\n\ndefine('background/msgRouter',[\n], function(){\n    function MessageRouter(){\n        this.actionPrefix = 'ts_ext_';\n        chrome.runtime.onMessage.addListener(this.messageListener.bind(this));\n\n        this.add = function(a,b){\n            this[a] = b;\n        };\n    }\n\n    // one action - one callback\n    MessageRouter.prototype.map = {};\n\n    /**\n     * Function, which handles messages\n     * @param {Object} request POJO with required 'action' property\n     * @param {String} request.action\n     * @param {Object} sender Chrome tab\n     * @param {Function} sendResponse Call special function, which is waiting for an answer\n     * @returns {undefined}\n     */\n    MessageRouter.prototype.messageListener = function (request, sender, sendResponse) {\n        try{\n            var action = request.action;\n            if ( this.map[action] && typeof this.map[action] === 'function' ){\n                this.map[action](request, sender, sendResponse); // provide already bound functions if needed\n            }\n        }catch(err){\n            console.warn('Message processing has failed. Let the developer know about that.');\n        }\n    };\n\n    /**\n     * Add one association \"action->handler\", which is checked with every\n     * message came\n     * @param {String} action\n     * @param {Function} callback\n     * @returns {undefined}\n     */\n    MessageRouter.prototype.addListener = function (action, callback) {\n        this.map[this.actionPrefix + action] = callback; // one action - one callback\n    };\n\n    return new MessageRouter();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/localStorage',[\n], function(){\n    var ls = window.localStorage;\n    // handles local storage\n    function Storage(){\n\n    }\n\n    Storage.prototype.setItem = function(name, item, skipStringify){\n        try{\n            ls.setItem(name, skipStringify ? item : JSON.stringify(item));\n        }catch(err){\n            console.error('setItem fails', err);\n            return false;\n        }\n        return true;\n    };\n\n    Storage.prototype.getItem = function(name, skipParse){\n        var item;\n        try{\n            item = ls.getItem(name);\n            item = skipParse ? item : JSON.parse(item);\n        }catch(err){\n            console.error('setItem fails', err);\n            return false;\n        }\n        return item;\n    };\n\n    return new Storage();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/state',[\n    'background/msgRouter',\n    'background/localStorage'\n], function (msgRouter, ls) {\n    // handles clicks on 'start' popup button (it may change its caption)\n    function State() {\n\n    }\n    // d is for data\n    State.prototype.d = {\n        started: false,\n        tickets: []\n    };\n\n    State.prototype.init = function () {\n        if (!this.__init) {\n            msgRouter.addListener('getState', this.onMsgGetState.bind(this));\n            this.restoreState();\n            this.__init = true;\n        }\n        return this;\n    };\n\n    State.prototype.onMsgGetState = function (request, sender, sendResponse) {\n        sendResponse(this.getState());\n    };\n\n    /**\n     *\n     * @returns {Boolean} Current state after switch\n     */\n    State.prototype.toggleDayStart = function () {\n        var d = this.d;\n        if (d.started) {\n            d.started = false;\n            d.endTime = new Date().getTime();\n        } else {\n            d.started = true;\n            d.startTime = new Date().getTime();\n        }\n        this.setState();\n    };\n\n    State.prototype.startTicket = function (contentPageData) {\n        if (!this.validateTicketData(contentPageData)) {\n            return;\n        }\n        this.d.tickets = this.d.tickets || [];\n        var ticket, t;\n        t = contentPageData;\n\n\n        // we'll start with having only one active ticket\n        /*\n         ticket = this.getTicketById(t.id);\n         if (ticket){\n            ticket.started = new Date().getTime();\n         }else{\n         ticket = {\n            id: t.id,\n            subject: t.subject,\n            queue: t.queue,\n            started: new Date().getTime()\n         };\n         this.d.tickets.push(ticket);\n         }\n         */\n\n        // implementation of single-ticket approach\n        this.d.tickets = []; // drop everything\n        ticket = {\n            id: t.id,\n            subject: t.subject,\n            queue: t.queue,\n            started: new Date().getTime()\n        };\n        this.d.tickets.push(ticket);\n\n        this.setState();\n        this.broadcastUpdateState();\n\n        var n = new Notification('Ticket started', {\n            icon: 'img/icon48.png',\n            body: ticket.id + ': ' + ticket.subject\n        });\n        setTimeout(n.close.bind(n), 3000);\n        return ticket;\n    };\n\n    State.prototype.validateTicketData = function (data) {\n        return data.id && data.queue && data.subject;\n    };\n\n    State.prototype.getTicketById = function (id) {\n        this.d.tickets = this.d.tickets || [];\n        return this.d.tickets.filter(function (item) {\n            return item.id === id;\n        })[0];\n    };\n    /**\n     *\n     * @param {Object} opts\n     * @returns {Object} State\n     */\n    State.prototype.setOptions = function (opts) {\n        var d = this.d;\n        opts = opts || opts;\n        this.d.opts = opts;\n        \n        this.setState();\n        this.broadcastUpdateState();\n\n        return this.getState();\n    };\n\n    State.prototype.broadcastUpdateState = function () {\n        chrome.runtime.sendMessage(\n            {action: 'ts_ext_updateState', state: this.d}\n        );\n    };\n\n    State.prototype.restoreState = function () {\n        var state = this.getState();\n        if (!!state) {\n            this.d = state;\n        }\n    };\n\n    State.prototype.setState = function () {\n        ls.setItem('state', this.d);\n    };\n\n    State.prototype.getState = function () {\n        return ls.getItem('state') || {};\n    };\n\n    return new State().init();\n\n});\n\n\n","/* global module, define */\n(function () {\n    function moduleDefiniton() {\n        /**\n         * Manage RT with its REST API\n         * @class RT\n         * @param {Object} [cfg]\n         * @param {String} [cfg.url]\n         * @singleton\n         */\n        function RT(cfg) {\n\n            function init() {\n                this.url = cfg.url || this.url; // always put a property in instance, I wanna see it in console\n                this.debug = typeof cfg.debug !== 'undefined' ? cfg.debug : this.debug;\n            }\n\n            /**\n             *\n             * @param {Number|String} id\n             * @param {Function} [callback]\n             * callback param:\n             *      {\n             *          success: true,\n             *          ticketData: {\n             *              id: \"1\",\n             *              owner: \"you\"\n             *          },\n             *          errorText: \"\"\n             *      }\n             * @return {undefined}\n             */\n            this.getTicket = function (id, callback) {\n                var fullUrl;\n                fullUrl = this.url + this.getTicketPattern.replace('%id%', id);\n                this.ajax({\n                    method: 'POST',\n                    url: fullUrl,\n                    success: this.onGetTicket.bind(this, callback),\n                    error: this.onGetTicketError.bind(this, callback)\n                });\n            };\n\n            return init.call(this);\n        }\n\n\n        var protoStuff = {\n            /**\n             * @param {String}\n             */\n            url: 'http://rt.easter-eggs.org/demos/4.2/',\n            getTicketPattern: 'ticket/%id%/show',\n            debug: true,\n            /**\n             * Custom AJAX function, implement it yourself if wanna be jquery-independent\n             */\n            nonJqueryAjax: null,\n            onGetTicket: function (callback, res) {debugger;\n                var parsedRes = this.parseResponse(res);\n\n                if (!parsedRes.success){\n                    this.debug && console.error('Error getting ticket data: ', parsedRes.errorText || '<No error text>');\n                }else if ( callback && typeof callback === 'function' ){\n                    callback(parsedRes); // assuming scope and everything is bound already\n                }\n            },\n            onGetTicketError: function (callback, res) {\n                var errorText = res.statusText || '<No error text>';\n                this.debug && console.error('Error getting ticket data: ', errorText, ' Status: ' + res.status);\n\n                if ( callback && typeof callback === 'function' ){\n                    callback({\n                        success: false,\n                        data: {},\n                        errorText: errorText\n                    });\n                }\n            },\n            parseResponse: function(ticketResponse){\n                var r, statusLine, emptyLine, possibleErrorLine, data, line, success, errorText;\n                data = {};\n                success = true;\n                errorText ='';\n                r = ticketResponse;\n                r = r.split('\\n');\n\n                statusLine = r.shift();\n                emptyLine = r.shift();\n                possibleErrorLine = r[0];\n\n                if (!statusLine || statusLine.toLowerCase().indexOf('200 ok') < 0 || emptyLine !== ''){\n                    errorText = 'Something went wrong, incorrect server answer structure.';\n                    success = false;\n                }else if ( possibleErrorLine && possibleErrorLine.indexOf('#') === 0 ){\n                    possibleErrorLine = possibleErrorLine.replace('#', '').replace(/^\\s+/gim, '');\n                    errorText = possibleErrorLine;\n                    success = false;\n                }else{\n                    for (var i = 0; i < r.length; i++){\n                        line = r[i];\n                        if (line !== '' && !!line && line.indexOf(': ')){\n                            line = line.split(': ');\n                            if ( line.length >= 2 ){\n                                if (line[0] === 'id'){\n                                    line[1] = line[1].replace('ticket/', '');\n                                }\n                                data[line.shift().toLowerCase()] = line.join(':');\n                            }\n                        }\n                    }\n                }\n\n                return {\n                    success: success,\n                    errorText: errorText,\n                    ticketData: data\n                };\n            },\n            ajax: function(ajaxParams){\n                if (this.nonJqueryAjax){\n                    return this.nonJqueryAjax(ajaxParams);\n                }else{\n                    return $.ajax(ajaxParams);\n                }\n            }\n        };\n\n        for (var stuffName in protoStuff) {\n            if (typeof protoStuff[stuffName] === 'function') {\n                RT.prototype[stuffName] = protoStuff[stuffName].bind(RT.prototype);\n            } else {\n                RT.prototype[stuffName] = protoStuff[stuffName];\n            }\n        }\n\n        return RT;\n    }\n\n    if (typeof define === \"function\" && define.amd) {\n        define('background/rt',[], moduleDefiniton);\n    } else if (typeof module === \"object\" && module.exports) {\n        module.exports = moduleDefiniton;\n    } else {\n        window['RTIConstructor'] = moduleDefiniton();\n    }\n})();\n","/* global chrome */\n\ndefine('background/listenContent',[\n    'background/record',\n    'background/msgRouter',\n    'background/state',\n    'background/rt'\n], function(record, msgRouter, state, RTConstructor){\n    msgRouter.addListener('ticketDetails', makeRecordRemote);\n    msgRouter.addListener('startTicket', startTicket);\n    //https://www.iponweb.net/rt/REST/1.0/\n    window.RT = new RTConstructor({\n        url: 'https://www.iponweb.net/rt/REST/1.0/'\n    });\n    function makeRecord(request, sender, sendResponse){\n        var recordString = record.make.apply(record, arguments);\n        sendResponse(recordString);\n    }\n    /**\n     *\n     * @param {Object} request\n     * @param {String} request.id\n     * @param {String} request.queue\n     * @param {String} request.subject\n     * @param {type} sender\n     * @param {type} sendResponse\n     * @returns {undefined}\n     */\n    function makeRecordRemote(request, sender, sendResponse){debugger;\n        //var recordString = record.make.apply(record, arguments);\n        //sendResponse(recordString);\n        var ticketData = RT.getTicket(request.id, makeRemoteAnswer.bind(this, sender.tab.id));\n    }\n\n    function makeRemoteAnswer(senderTabId, getTicketResponse){debugger;\n        var recordString;\n        getTicketResponse = getTicketResponse || {};\n        if ( getTicketResponse.success && getTicketResponse.ticketData){\n            recordString = record.make.apply(record, [getTicketResponse.ticketData]);\n            chrome.tabs.sendMessage(\n                senderTabId,\n                {\n                    text: recordString,\n                    method: 'tsBringTicketString'\n                }\n            );\n        }\n    }\n\n    function startTicket(request, sender, sendResponse){\n        var ticket = state.startTicket(request);\n        sendResponse(ticket);\n    }\n});\n\n\n","/* global chrome */\n\ndefine('background/popupStartController',[\n    'background/state'\n], function(state){\n    // handles clicks on 'start' popup button (it may change its caption)\n    function PopupStartController(){\n\n    }\n\n    PopupStartController.prototype.onClick = function(request, sender, sendResponse){\n        state.toggleDayStart();\n        sendResponse(state.d);\n    };\n\n    return new PopupStartController();\n\n});\n\n\n","/* global chrome */\n\ndefine('background/listenPopup',[\n    'background/msgRouter',\n    'background/popupStartController'\n], function(msgRouter, popupStartController){\n    msgRouter.addListener('popupStartButton', popupStartController.onClick.bind(popupStartController));\n});\n\n\n","/* global chrome */\n\ndefine('background/listenOptions',[\n    'background/msgRouter',\n    'background/state'\n], function(msgRouter, state){\n    msgRouter.addListener('setOptions', setOptions);\n\n    function setOptions(request){\n        try{\n            state.setOptions(request.opts);\n        }catch(err){\n            // and what?, TODO\n        }\n    }\n\n});\n\n\n","/**\n * This is the main JS file for background script, it is a subject to grunt's build routine.\n */\n\nrequire([\n    'background/clickHandler',\n    'background/listenContent',\n    'background/listenPopup',\n    'background/listenOptions'\n], function(){\n});\n\ndefine(\"BackgroundMain\", function(){});\n\n"]}