define("common/dates",[],function(){function t(){}return t.prototype.weekdays={full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"short":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},t.prototype.months={full:["January","February","March","April","May","June","July","August","September","October","November","Decemeber"],"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},t.prototype.getFullDate=function(t,e){return this.getHumanDate(t)+" "+this.getHumanTime(t,e)},t.prototype.getHumanDate=function(t){var e,n,o;return t=new Date(t.getTime()),e=this.xx(t.getMonth()+1),n=this.xx(t.getDate()),o=t.getFullYear()+"-"+e+"-"+n},t.prototype.getHumanTime=function(t,e){var n,o,r,i;return n=this.xx(t.getHours()),o=this.xx(t.getMinutes()),r=this.xx(t.getSeconds()),i=n+":"+o+(e?":"+r:"")},t.prototype.xx=function(t){return t=parseInt(t,10),10>t?"0"+t:t+""},t.prototype.getDayName=function(t,e){e=e||{};var n=t||new Date;return this.weekdays[e["short"]?"short":"full"][n.getDay()]},t.prototype.getMonthName=function(t,e){e=e||{};var n=t||new Date;return this.months[e["short"]?"short":"full"][n.getMonth()]},new t}),define("background/record",["common/dates"],function(t){function e(){}return e.prototype.make=function(e){var n,o,r,i;e.subject=this.sanitizeSubject(e.subject);var s=[e.queue,e.id,e.subject];return s[1]="RT:"+s[1],s[2]='"'+s[2]+'"',o=new Date,n=t.getHumanDate(o),r=t.getHumanTime(o),o.setHours(10),o.setMinutes(0),i=t.getHumanTime(o),s.unshift(r),s.unshift(i),s.unshift(n),s=s.join(","),this.copy(s),s},e.prototype.copy=function(t){var e=document.createElement("div");e.contentEditable=!0,document.body.appendChild(e),e.innerHTML=t,e.unselectable="off",e.focus(),document.execCommand("SelectAll"),document.execCommand("Copy",!1,null),document.body.removeChild(e)},e.prototype.sanitizeSubject=function(t){var e;return e=t.replace(/"/gim,"'")},new e}),define("background/clickHandler",["background/record"],function(t){function e(t,e){chrome.tabs.sendMessage(e.id,{method:"tsGetDetails"},n.bind(this,t))}function n(e,n){n=n||{},t.make(n)}chrome.contextMenus.create({title:"Form TS rec and ctrl+C",contexts:["page","selection"],onclick:e})}),define("background/msgRouter",[],function(){function t(){this.actionPrefix="ts_ext_",chrome.runtime.onMessage.addListener(this.messageListener.bind(this)),this.add=function(t,e){this[t]=e}}return t.prototype.map={},t.prototype.messageListener=function(t,e,n){try{var o=t.action;this.map[o]&&"function"==typeof this.map[o]&&this.map[o](t,e,n)}catch(r){console.warn("Message processing has failed. Let the developer know about that.")}},t.prototype.addListener=function(t,e){this.map[this.actionPrefix+t]=e},new t}),define("background/localStorage",[],function(){function t(){}var e=window.localStorage;return t.prototype.setItem=function(t,n,o){try{e.setItem(t,o?n:JSON.stringify(n))}catch(r){return console.error("setItem fails",r),!1}return!0},t.prototype.getItem=function(t,n){var o;try{o=e.getItem(t),o=n?o:JSON.parse(o)}catch(r){return console.error("setItem fails",r),!1}return o},new t}),define("background/state",["background/msgRouter","background/localStorage"],function(t,e){function n(){}return n.prototype.d={started:!1,tickets:[]},n.prototype.init=function(){return this.__init||(t.addListener("getState",this.onMsgGetState.bind(this)),this.restoreState(),this.__init=!0),this},n.prototype.onMsgGetState=function(t,e,n){n(this.getState())},n.prototype.toggleDayStart=function(){var t=this.d;t.started?(t.started=!1,t.endTime=(new Date).getTime()):(t.started=!0,t.startTime=(new Date).getTime()),this.setState()},n.prototype.startTicket=function(t){if(this.validateTicketData(t)){this.d.tickets=this.d.tickets||[];var e,n;n=t,this.d.tickets=[],e={id:n.id,subject:n.subject,queue:n.queue,started:(new Date).getTime()},this.d.tickets.push(e),this.setState(),this.broadcastUpdateState();var o=new Notification("Ticket started",{icon:"img/icon48.png",body:e.id+": "+e.subject});return setTimeout(o.close.bind(o),3e3),e}},n.prototype.validateTicketData=function(t){return t.id&&t.queue&&t.subject},n.prototype.getTicketById=function(t){return this.d.tickets=this.d.tickets||[],this.d.tickets.filter(function(e){return e.id===t})[0]},n.prototype.setOptions=function(t){this.d;return t=t||t,this.d.opts=t,this.setState(),this.broadcastUpdateState(),this.getState()},n.prototype.broadcastUpdateState=function(){chrome.runtime.sendMessage({action:"ts_ext_updateState",state:this.d})},n.prototype.restoreState=function(){var t=this.getState();t&&(this.d=t)},n.prototype.setState=function(){e.setItem("state",this.d)},n.prototype.getState=function(){return e.getItem("state")||{}},(new n).init()}),function(){function t(){function t(t){function e(){this.url=t.url||this.url,this.debug="undefined"!=typeof t.debug?t.debug:this.debug}return this.getTicket=function(t,e){var n;n=this.url+this.getTicketPattern.replace("%id%",t),this.ajax({method:"POST",url:n,success:this.onGetTicket.bind(this,e),error:this.onGetTicketError.bind(this,e)})},e.call(this)}var e={url:"http://rt.easter-eggs.org/demos/4.2/",getTicketPattern:"ticket/%id%/show",debug:!0,nonJqueryAjax:null,onGetTicket:function(t,e){var n=this.parseResponse(e);n.success?t&&"function"==typeof t&&t(n):this.debug&&console.error("Error getting ticket data: ",n.errorText||"<No error text>")},onGetTicketError:function(t,e){var n=e.statusText||"<No error text>";this.debug&&console.error("Error getting ticket data: ",n," Status: "+e.status),t&&"function"==typeof t&&t({success:!1,data:{},errorText:n})},parseResponse:function(t){var e,n,o,r,i,s,a,u;if(i={},a=!0,u="",e=t,e=e.split("\n"),n=e.shift(),o=e.shift(),r=e[0],!n||n.toLowerCase().indexOf("200 ok")<0||""!==o)u="Something went wrong, incorrect server answer structure.",a=!1;else if(r&&0===r.indexOf("#"))r=r.replace("#","").replace(/^\s+/gim,""),u=r,a=!1;else for(var c=0;c<e.length;c++)s=e[c],""!==s&&s&&s.indexOf(": ")&&(s=s.split(": "),s.length>=2&&("id"===s[0]&&(s[1]=s[1].replace("ticket/","")),i[s.shift().toLowerCase()]=s.join(":")));return{success:a,errorText:u,ticketData:i}},ajax:function(t){return this.nonJqueryAjax?this.nonJqueryAjax(t):$.ajax(t)}};for(var n in e)"function"==typeof e[n]?t.prototype[n]=e[n].bind(t.prototype):t.prototype[n]=e[n];return t}"function"==typeof define&&define.amd?define("background/rt",[],t):"object"==typeof module&&module.exports?module.exports=t:window.RTIConstructor=t()}(),define("background/listenContent",["background/record","background/msgRouter","background/state","background/rt"],function(t,e,n,o){function r(t,e,n){RT.getTicket(t.id,i.bind(this,e.tab.id))}function i(e,n){var o;n=n||{},n.success&&n.ticketData&&(o=t.make.apply(t,[n.ticketData]),chrome.tabs.sendMessage(e,{text:o,method:"tsBringTicketString"}))}function s(t,e,o){var r=n.startTicket(t);o(r)}e.addListener("ticketDetails",r),e.addListener("startTicket",s),window.RT=new o({url:"https://www.iponweb.net/rt/REST/1.0/"})}),define("background/popupStartController",["background/state"],function(t){function e(){}return e.prototype.onClick=function(e,n,o){t.toggleDayStart(),o(t.d)},new e}),define("background/listenPopup",["background/msgRouter","background/popupStartController"],function(t,e){t.addListener("popupStartButton",e.onClick.bind(e))}),define("background/listenOptions",["background/msgRouter","background/state"],function(t,e){function n(t){try{e.setOptions(t.opts)}catch(n){}}t.addListener("setOptions",n)}),require(["background/clickHandler","background/listenContent","background/listenPopup","background/listenOptions"],function(){}),define("BackgroundMain",function(){});
//# sourceMappingURL=ext.min.js.map